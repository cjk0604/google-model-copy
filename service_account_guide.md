# Google Cloud 서비스 계정 (Service Account) 및 JSON 키 발급 가이드

이 문서에서는 화면(UI)이 없는 원격 서버(예: AWS EC2, 온프레미스 서버)나 CI/CD 파이프라인에서 Google Cloud의 리소스(Vertex AI 등)에 인증하고 접근하기 위한 **서비스 계정(Service Account)** 및 **JSON 키 페어**를 발급받는 방법을 안내합니다.

## 1. 서비스 계정이란?
사용자(개발자)의 개인 Google 계정 대신, **애플리케이션(코드)이나 프로그램이 Google Cloud API를 직접 호출하도록 만들어진 특별한 계정**입니다. 서버 환경에서는 유출 위험과 권한 범위를 최소화하기 위해 반드시 서비스 계정 키를 사용해야 합니다.

## 2. 서비스 계정 생성 및 권한 부여 방법

### Step 1: 서비스 계정 생성 메뉴로 이동
1. [Google Cloud Console](https://console.cloud.google.com/) 에 접속하여 로그인합니다.
2. 좌측 상단의 햄버거 버튼(탐색 메뉴) ☰을 클릭하고 **[IAM 및 관리자] > [서비스 계정(Service Accounts)]** 으로 이동합니다.
3. 상단의 **`[+ 서비스 계정 만들기(CREATE SERVICE ACCOUNT)]`** 버튼을 클릭합니다.

### Step 2: 계정 정보 입력 및 역할(Role) 부여
1. **[1단계]** 서비스 계정 이름과 ID(자동 생성), 계정 설명("모델 복사 파이프라인용 계정" 등)을 입력하고 `만들고 계속하기`를 누릅니다.
2. **[2단계]** 생성된 계정에 이 프로젝트 리소스에 접근할 수 있는 **역할(권한)**을 부여해야 합니다. 모델 파인튜닝/복사 진행을 위해서는 보통 다음 역할을 추가합니다:
   - **`Vertex AI 관리자 (Vertex AI Administrator)`**
   - **`저장소 개체 뷰어 (Storage Object Viewer)`** (GCS 학습데이터 접근용)
   - *팁: 소스(Source) 및 타겟(Target) 프로젝트가 다르다면, 양쪽 프로젝트 모두에서 이 서비스 계정(이메일 형식)에게 권한을 부여해야 정상적으로 모델을 불러오고 복사할 수 있습니다.*
3. 권한을 선택하셨다면 `완료`를 클릭합니다.

## 3. JSON 키(Key) 생성 및 다운로드

서비스 계정을 만들었다면, 코드가 자신을 증명할 수 있는 인증서 파일인 JSON 키 페어를 생성해야 합니다.

1. 방금 생성된 서비스 계정 목록 화면에서 해당 계정의 **`이메일 주소`**를 클릭하여 세부정보로 들어갑니다.
2. 상단의 **[키 (KEYS)]** 탭으로 이동합니다.
3. **[키 추가 (ADD KEY)]** 드롭다운 버튼을 클릭하고 **`새 키 만들기(Create new key)`** 를 선택합니다.
4. 키 유형으로 **`JSON`** 이 선택된 것을 확인하고 **[만들기(Create)]** 를 누릅니다.
5. 로컬 PC에 `.json` 확장자의 파일이 자동으로 다운로드되며, 고유 키 값이 화면에 출력됩니다. 
   > ⚠️ **[주의 사항]** 
   > 이 JSON 파일 안에 **비밀 키(Private Key)** 가 평문으로 담겨있습니다. 절대로 GitHub나 외부에 노출되지 않도록 안전하게 보관하세요.

## 4. 원격 서버 / AWS EC2 에서 JSON 키 연동하기

이제 발급받은 JSON 파일을 실제로 코드가 돌아갈 원격 서버로 가져와야 합니다.

1. 터미널(scp)이나 sftp 툴을 이용해 다운로드 받은 `*.json` 파일을 AWS EC2 인스턴스 등의 서버로 전송합니다. (예: `/home/ubuntu/sa-key.json`)
2. EC2 내부 터미널에 접속하여 구글 클라우드 공식 환경변수인 `GOOGLE_APPLICATION_CREDENTIALS`에 파일 경로를 지정해 줍니다.
   ```bash
   export GOOGLE_APPLICATION_CREDENTIALS="/home/ubuntu/sa-key.json"
   ```
3. 이후 기존 파이썬 스크립트(`python3 copy_model.py` 등)를 실행하면, **소스 코드 변경 없이** Python SDK 가 자동으로 환경변수를 찾아 해당 서비스 계정으로 Google Cloud 에 안전하게 인증합니다.
